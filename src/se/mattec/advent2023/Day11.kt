package se.mattec.advent2023

import kotlin.math.abs
import kotlin.math.max
import kotlin.math.min

fun main() {
    println(Skeleton.problem1())
    println(Skeleton.problem2())
}

object Skeleton {

    fun problem1(): String {
        val universe = data.toMutableList()
        val emptyRowIndices = universe
            .mapIndexed { rowIndex: Int, row: String -> if (row.toSet().size == 1) rowIndex else -1 }
            .filter { it != -1 }
        val emptyColumnIndices = universe[0].indices
            .map { colIndex -> if (universe.map { it[colIndex] }.toSet().size == 1) colIndex else -1 }
            .filter { it != -1 }

        emptyRowIndices.reversed().forEach { rowIndex ->
            universe.add(rowIndex, (0 until data[1].length).joinToString("") { "." })
        }

        emptyColumnIndices.reversed().forEach { colIndex ->
            for (i in universe.indices) {
                universe[i] = universe[i].substring(0, colIndex) + "." + universe[i].substring(colIndex)
            }
        }

        val galaxies = mutableSetOf<Pair<Int, Int>>()
        universe.forEachIndexed { rowIndex, row ->
            row.forEachIndexed { colIndex, char ->
                if (char == '#') {
                    galaxies += rowIndex to colIndex
                }
            }
        }

        val pairs = mutableSetOf<Set<Pair<Int, Int>>>()
        galaxies.forEach { g1 ->
            galaxies.forEach { g2 ->
                pairs += setOf(g1, g2)
            }
        }

        val distances = pairs
            .filter { it.size == 2 }
            .map {
                val setAsList = it.toList()
                val g1 = setAsList[0]
                val g2 = setAsList[1]
                abs(g1.first - g2.first) + abs(g1.second - g2.second)
            }

        return distances.sum().toString()
    }

    private const val NUM_EMPTY = 1_000_000L

    fun problem2(): String {
        val universe = data.toMutableList()
        val emptyRowIndices = universe
            .mapIndexed { rowIndex: Int, row: String -> if (row.toSet().size == 1) rowIndex else -1 }
            .filter { it != -1 }
        val emptyColumnIndices = universe[0].indices
            .map { colIndex -> if (universe.map { it[colIndex] }.toSet().size == 1) colIndex else -1 }
            .filter { it != -1 }

        val galaxies = mutableSetOf<Pair<Int, Int>>()
        universe.forEachIndexed { rowIndex, row ->
            row.forEachIndexed { colIndex, char ->
                if (char == '#') {
                    galaxies += rowIndex to colIndex
                }
            }
        }

        val pairs = mutableSetOf<Set<Pair<Int, Int>>>()
        galaxies.forEach { g1 ->
            galaxies.forEach { g2 ->
                pairs += setOf(g1, g2)
            }
        }

        val distances = pairs
            .filter { it.size == 2 }
            .map {
                val setAsList = it.toList()
                val g1 = setAsList[0]
                val g2 = setAsList[1]
                val rowExpansion = emptyRowIndices.filter {
                    it > min(g1.first, g2.first) && it < max(g1.first, g2.first)
                }
                val colExpansion = emptyColumnIndices.filter {
                    it > min(g1.second, g2.second) && it < max(g1.second, g2.second)
                }
                abs(g1.first - g2.first) + rowExpansion.size * (NUM_EMPTY - 1) + abs(g1.second - g2.second) + colExpansion.size * (NUM_EMPTY - 1)
            }

        return distances.sum().toString()
    }

    private val data = """
..#..........#................................................#.............................................................................
...................................#............................................#..........................#............................#...
......................................................................#.............................#.......................................
........#...................................#..................................................................................#............
.................#.........#..........#...............#........................................#.................#..........................
.................................#..............#...................................#.......................................................
#.........................................................................#...............#............................#....................
.......................#........................................................#...........................................................
.......#.........................................................#................................#.................................#.......
..................#...............................#...........................................................#.............................
...........#.................................#..............#................................................................#...........#..
..........................#........#........................................................................................................
.#..................................................................#................#.................#....................................
......................#.........................#.....................................................................................#.....
..........................................#....................#..............#....................#........................................
.........................................................................................#.........................#.....#..................
..............#.............................................................................................................................
..........................................................................................................#........................#........
.....#.........................#.............#....................#.......#........#........................................#...............
..........................#...........#...............................................................#.....................................
...................#...........................................................................#................#...........................
#............#........................................#................................................................................#....
......................................................................................................................#.........#...........
........................................#...................................................................................................
...#............#........#...........................................................#......................................................
.............................................#..............................................................................................
............#.......#..........................................................................#..................#.....#...................
................................................................................#.........................#....................#.....#......
.................................................................#..........................................................................
..........................#...............#.................................................#.................#.............................
#.........#...........................................#............................................#........................................
.....................#................#................................#....................................................................
.....................................................................................#.....................#............#...................
............................................................................................................................................
.............................#..........................................................................................................#...
.................#..................#......#......#............................#......................#..........#...........#..............
.......#.................#...........................................#......................................................................
......................................................................................#.....................................................
...#....................................................#......#..................................#.........................................
............#........#.........#..............#.........................#....................................#..............................
.......................................................................................................#................#.....#.............
..............................................................................................#.............................................
....................................................................................#..............................#......................#.
#.............#.........#..................#.............................................#...........................................#......
.............................#......#...........#.........#...................#.............................................................
.......#...........................................................................................#.....#..................................
...................#........................................................................................................#.....#.........
....................................................#..................#....................................................................
.................................#............................#.............................................................................
.......................#.................................#...........................................................................#......
........................................#..........................................#............#...............#...........................
.........................................................................................#..................................................
.............................................#......................#.......................................................................
..........................#...........................................................................#.........................#...........
............................................................................................................................................
...........#....................................................................#......#....................................................
....................................................................................................................#......................#
...............#........................#....................................................#..............................................
.....#.........................................#................#...........................................................................
.......................#.............................................#................................#..................#.........#........
#.........#.........................................#..........................#........#.......................#...........................
..............................#.............................................................................................................
.....................................#....................................................................#.....................#...........
..............................................................#.............#...............................................................
..#......................................................................................................................................#..
.................#.........#........................................................#....................................#..................
................................#.......................#.......................................#...........................................
..........................................#.....#...................................................................#.......................
......#......#.........................................................................................#......................#.............
......................................#..............#......................................................................................
..................#...........#.................................#...........................................................................
..#.......#............................................................................#...................................................#
......................#..................................#..............#...................................................................
..........................................................................................................................#.................
.................................#.........#....................................................#...........................................
............................................................................................................................................
....................#...............................................................................#.......................................
.#...................................#..........#...........................................................................................
.......#..............................................................#.................................#...................................
.............................#...........#.....................#.................................#.............................#............
.......................#....................................................................#...................#......................#....
.............#.....................#.................#..........................#....................................#......................
...........................................................................#............#...........#..............................#........
..........................................................................................................................................#.
.#..............................#...........................................................................................................
.............................................#............#...............................................#.................................
...............#.......#..........................#.................#.......................#...........................#...................
...............................................................................#.................................................#..........
.........#..............................#..............................................................#......#.............................
............................................................................................................................................
................................................#........................................#..................................................
.........................................................................#......................#.....................................#.....
...........#......#..........#......................#......................................................................#................
..........................................................#...................#.....#.......#.....................#.........................
......................................#.....................................................................................................
........#................................................................................................................................#..
......................#........................#................#....................................#........#.............................
..#.......................................#.......................................................................................#.........
..............#.............................................................................................................................
.........................................................................#..................................................................
.........................#..........#........#........................................#.....................................................
.....#..................................................#..................................................................................#
..............................#................................#..............#..............#................#............#................
........................................................................................................#.............#.........#...........
.#.............#.......................................................#....................................................................
.......................................#....................................................................................................
.......................#..........................#.......#.................................................................................
.......#........................................................................#...........................................................
............................#........................................#................................................................#.....
..........................................#..........#........................................................#.............................
..............#..........................................................................#.....#..................................#.........
#...........................................................................................................................................
..................................#................................................................#........................#...............
..................................................................#.........................#...............#..........................#....
.......................................#...................................#..........#............................#........................
..................#.....#.....#.............#..........................................................#....................................
...................................................................................................................................#........
......................................................#.......................................................#.............................
...........#...............#...................#...............#....................#...............#.................#.....................
.........................................#......................................................................................#...........
...............................#.........................................................#......#.................#.....................#...
..#.................................................#....................................................#...............#..................
........#.............................#.....................................................................................................
..............#.........#................................................#..................................................................
..........................................#.....................................#....................#.......................#..............
............................................................................................................................................
................................#...............#..........................................................#.....#...............#..........
..#.......#.................................................................................................................................
........................................................................#...............................................#...................
............................#.................................#.........................#..........#........................................
....................#.............................#.........................................................................#...............
........................................................#....................................#..........#......#............................
........#...................................................................................................................................
.........................................................................#..........#.......................................................
............#......................#............#.................................................................#.....................#...
.............................#.....................................................................#........................................
........................................................................................................................#...................
.......#.........#...........................................................................#.........#......#.............................
........................#.............................#..........#...................................................................#......
...#.................................#........#................................#.....#.......................................#..............
    """.trimIndent()
        .split("\n")

}